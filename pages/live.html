<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live - Football Stats</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öΩ</text></svg>">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üì∫ Suivi Live du Match</h1>
            <p id="liveStatus">Chargement des donn√©es...</p>
        </header>

        <!-- Navigation (masqu√©e en mode spectateur) -->
        <nav class="nav-tabs" id="navigation">
            <a href="../index.html" class="nav-link">üè† Accueil</a>
            <a href="team.html" class="nav-link">üë• √âquipe</a>
            <a href="composition.html" class="nav-link">üìã Compo</a>
            <a href="match.html" class="nav-link">‚öΩ Match</a>
            <a href="live.html" class="nav-link active">üì∫ Live</a>
            <a href="stats.html" class="nav-link">üìä Stats</a>
        </nav>

        <!-- Contenu principal -->
        <main class="main-content">
            
            <!-- Indicateur de connexion -->
            <div class="team-card" id="connectionStatus">
                <div class="connection-indicator">
                    <div class="status-icon" id="statusIcon">üîÑ</div>
                    <div class="status-text" id="statusText">Connexion en cours...</div>
                    <div class="last-update" id="lastUpdate">Derni√®re mise √† jour: jamais</div>
                </div>
                <div class="live-controls" id="liveControls" style="display: none;">
                    <button class="btn btn-primary" onclick="refreshLiveData()">üîÑ Actualiser</button>
                    <button class="btn btn-secondary" onclick="toggleAutoRefresh()">
                        <span id="autoRefreshText">‚è∏Ô∏è Arr√™ter Auto</span>
                    </button>
                </div>
            </div>

            <!-- Tableau de bord du match -->
            <div class="team-card">
                <div class="live-match-header">
                    <div class="live-team-info">
                        <div class="live-team-name" id="liveTeamName">Mon √âquipe</div>
                        <div class="live-team-score" id="liveTeamScore">0</div>
                    </div>
                    
                    <div class="live-match-info">
                        <div class="live-match-time" id="liveMatchTime">00:00</div>
                        <div class="live-match-half" id="liveMatchHalf">1√®re Mi-temps</div>
                        <div class="live-match-status" id="liveMatchStatus">En cours</div>
                    </div>
                    
                    <div class="live-team-info">
                        <div class="live-team-name" id="liveOpponentName">√âquipe Adverse</div>
                        <div class="live-team-score" id="liveOpponentScore">0</div>
                    </div>
                </div>
            </div>

            <!-- Layout s√©par√© pour mobile -->
            <div class="live-layout">
                <!-- Timeline centrale -->
                <div class="live-timeline">
                    <h3>‚è±Ô∏è Timeline du Match</h3>
                    <div id="liveEventsTimeline" class="live-events-container">
                        <div class="live-event-item placeholder">
                            <div class="event-time">--:--</div>
                            <div class="event-content">
                                <div class="event-icon">üìù</div>
                                <div class="event-text">En attente d'√©v√©nements...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions √©quipe √† gauche (desktop) / en haut (mobile) -->
                <div class="live-team-actions left">
                    <h3 id="teamActionsTitle">üè† Mon √âquipe</h3>
                    <div id="teamEvents" class="team-events-list">
                        <p class="no-events">Aucune action enregistr√©e</p>
                    </div>
                </div>

                <!-- Actions √©quipe adverse √† droite (desktop) / en bas (mobile) -->
                <div class="live-team-actions right">
                    <h3 id="opponentActionsTitle">üî¥ √âquipe Adverse</h3>
                    <div id="opponentEvents" class="team-events-list">
                        <p class="no-events">Aucune action enregistr√©e</p>
                    </div>
                </div>
            </div>

            <!-- Statistiques en temps r√©el -->
            <div class="team-card">
                <h3>üìä Statistiques en Temps R√©el</h3>
                <div class="live-stats-grid">
                    <div class="stat-comparison">
                        <div class="stat-item">
                            <div class="stat-label">Buts</div>
                            <div class="stat-values">
                                <span class="team-stat" id="teamGoals">0</span>
                                <span class="stat-separator">-</span>
                                <span class="opponent-stat" id="opponentGoals">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Tirs</div>
                            <div class="stat-values">
                                <span class="team-stat" id="teamShots">0</span>
                                <span class="stat-separator">-</span>
                                <span class="opponent-stat" id="opponentShots">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Cartons</div>
                            <div class="stat-values">
                                <span class="team-stat" id="teamCards">0</span>
                                <span class="stat-separator">-</span>
                                <span class="opponent-stat" id="opponentCards">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Fautes</div>
                            <div class="stat-values">
                                <span class="team-stat" id="teamFouls">0</span>
                                <span class="stat-separator">-</span>
                                <span class="opponent-stat" id="opponentFouls">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Arr√™ts</div>
                            <div class="stat-values">
                                <span class="team-stat" id="teamSaves">0</span>
                                <span class="stat-separator">-</span>
                                <span class="opponent-stat" id="opponentSaves">0</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Coups Francs</div>
                            <div class="stat-values">
                                <span class="team-stat" id="teamFreeKicks">0</span>
                                <span class="stat-separator">-</span>
                                <span class="opponent-stat" id="opponentFreeKicks">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Composition des √©quipes -->
            <div class="team-card" id="compositionCard" style="display: none;">
                <h3>üë• Compositions</h3>
                <div class="compositions-grid">
                    <div class="team-composition">
                        <h4 id="teamCompositionTitle">Mon √âquipe</h4>
                        <div id="teamComposition" class="composition-list">
                            <!-- Composition de l'√©quipe -->
                        </div>
                    </div>
                    <div class="team-composition">
                        <h4>Banc de Touche</h4>
                        <div id="benchComposition" class="composition-list">
                            <!-- Banc de touche -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Informations du match -->
            <div class="team-card" id="matchInfoCard" style="display: none;">
                <h3>‚ÑπÔ∏è Informations du Match</h3>
                <div class="match-info-grid">
                    <div class="info-item">
                        <div class="info-label">üèüÔ∏è Lieu</div>
                        <div class="info-value" id="matchVenue">Stade Municipal</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">üìÖ Date</div>
                        <div class="info-value" id="matchDate">--/--/----</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">üïê Heure de d√©but</div>
                        <div class="info-value" id="matchStartTime">--:--</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">‚è±Ô∏è Dur√©e √©coul√©e</div>
                        <div class="info-value" id="matchDuration">--:--</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal d'erreur -->
    <div id="errorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeErrorModal()">&times;</span>
            <h3>‚ùå Erreur de Connexion</h3>
            <p id="errorMessage">Impossible de charger les donn√©es du match.</p>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="retryConnection()">üîÑ R√©essayer</button>
                <button class="btn btn-secondary" onclick="goToHomePage()">üè† Retour Accueil</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/storage.js"></script>
    <script src="../js/app.js"></script>
    <script>
        // Variables locales de la page live
        let isSpectatorMode = false;
        let autoRefreshEnabled = true;
        let refreshInterval = null;
        let currentLiveId = null;
        let currentBinId = null;
        let lastUpdateTime = null;
        let connectionAttempts = 0;
        let maxConnectionAttempts = 5;

        // Initialisation de la page
        document.addEventListener('DOMContentLoaded', function() {
            initializeLivePage();
        });

        /**
         * Initialisation de la page live
         */
        function initializeLivePage() {
            console.log('üî¥ Initialisation de la page Live');
            
            // V√©rifier les param√®tres URL pour le mode spectateur
            checkSpectatorMode();
            
            // Charger les donn√©es
            loadLiveData();
            
            // D√©marrer l'actualisation automatique
            startAutoRefresh();
            
            console.log('‚úÖ Page Live initialis√©e');
        }

        /**
         * V√©rification du mode spectateur
         */
        function checkSpectatorMode() {
            const urlParams = new URLSearchParams(window.location.search);
            currentLiveId = urlParams.get('live');
            currentBinId = urlParams.get('bin');
            
            if (currentLiveId) {
                isSpectatorMode = true;
                enableSpectatorMode();
                updateStatus('üî¥ Mode Spectateur', 'Connexion au match en cours...');
                console.log('Mode spectateur activ√©:', currentLiveId);
            } else {
                isSpectatorMode = false;
                updateStatus('üì± Mode Local', 'Affichage des donn√©es locales');
                showLocalData();
            }
        }

        /**
         * Activation du mode spectateur
         */
        function enableSpectatorMode() {
            // Masquer la navigation
            document.getElementById('navigation').style.display = 'none';
            
            // Afficher les contr√¥les live
            document.getElementById('liveControls').style.display = 'flex';
            
            // Modifier le titre
            document.querySelector('.header h1').textContent = 'üì∫ Match en Direct';
            
            // Ajouter la classe spectator au body
            document.body.classList.add('spectator-mode');
        }

        /**
         * Chargement des donn√©es live
         */
        async function loadLiveData() {
            try {
                updateStatus('üîÑ Chargement...', 'R√©cup√©ration des donn√©es du match...');
                
                let matchData = null;
                
                if (isSpectatorMode && currentLiveId) {
                    // Mode spectateur: charger depuis JSONBin ou localStorage
                    matchData = await getLiveData(currentLiveId, currentBinId);
                    
                    if (!matchData) {
                        throw new Error('Aucune donn√©e trouv√©e pour ce match');
                    }
                } else {
                    // Mode local: charger depuis l'√©tat de l'application
                    const state = footballApp.getState();
                    const config = getMatchConfig();
                    
                    matchData = {
                        config: config,
                        players: state.players,
                        events: state.events,
                        score: state.score,
                        time: state.time,
                        half: state.half
                    };
                }
                
                if (matchData) {
                    displayMatchData(matchData);
                    updateStatus('‚úÖ Connect√©', 'Donn√©es du match charg√©es');
                    connectionAttempts = 0;
                } else {
                    throw new Error('Aucune donn√©e disponible');
                }
                
            } catch (error) {
                console.error('Erreur chargement donn√©es live:', error);
                handleConnectionError(error.message);
            }
        }

        /**
         * Affichage des donn√©es du match
         */
        function displayMatchData(data) {
            try {
                // Informations g√©n√©rales
                const config = data.config || {};
                document.getElementById('liveTeamName').textContent = config.teamName || 'Mon √âquipe';
                document.getElementById('liveOpponentName').textContent = config.opponentName || '√âquipe Adverse';
                
                // Score et temps
                const score = data.score || { team: 0, opponent: 0 };
                document.getElementById('liveTeamScore').textContent = score.team;
                document.getElementById('liveOpponentScore').textContent = score.opponent;
                
                const time = data.time || 0;
                const half = data.half || 1;
                document.getElementById('liveMatchTime').textContent = footballApp.formatTime(time);
                document.getElementById('liveMatchHalf').textContent = half === 1 ? '1√®re Mi-temps' : '2√®me Mi-temps';
                
                // √âv√©nements
                const events = data.events || [];
                displayLiveEvents(events);
                
                // Statistiques
                calculateAndDisplayStats(events);
                
                // Compositions (si disponible)
                if (data.players && data.players.length > 0) {
                    displayCompositions(data.players);
                    document.getElementById('compositionCard').style.display = 'block';
                }
                
                // Informations du match
                if (config.venue || config.matchDate) {
                    displayMatchInfo(config);
                    document.getElementById('matchInfoCard').style.display = 'block';
                }
                
                // Mettre √† jour les titres
                document.getElementById('teamActionsTitle').textContent = `üè† ${config.teamName || 'Mon √âquipe'}`;
                document.getElementById('opponentActionsTitle').textContent = `üî¥ ${config.opponentName || '√âquipe Adverse'}`;
                
                lastUpdateTime = new Date();
                updateLastUpdateDisplay();
                
                console.log('Donn√©es affich√©es avec succ√®s');
                
            } catch (error) {
                console.error('Erreur affichage donn√©es:', error);
                showNotification('Erreur lors de l\'affichage des donn√©es', 'error');
            }
        }

        /**
         * Affichage des √©v√©nements live
         */
        function displayLiveEvents(events) {
            const timeline = document.getElementById('liveEventsTimeline');
            const teamEvents = document.getElementById('teamEvents');
            const opponentEvents = document.getElementById('opponentEvents');
            
            // Timeline centrale
            if (events.length === 0) {
                timeline.innerHTML = `
                    <div class="live-event-item placeholder">
                        <div class="event-time">--:--</div>
                        <div class="event-content">
                            <div class="event-icon">üìù</div>
                            <div class="event-text">Aucun √©v√©nement pour le moment</div>
                        </div>
                    </div>
                `;
            } else {
                timeline.innerHTML = '';
                
                events.forEach(event => {
                    const eventDiv = document.createElement('div');
                    eventDiv.className = 'live-event-item';
                    
                    const icon = getEventIcon(event);
                    const text = getEventText(event, events);
                    
                    eventDiv.innerHTML = `
                        <div class="event-time">${event.time}</div>
                        <div class="event-content">
                            <div class="event-icon">${icon}</div>
                            <div class="event-text">${text}</div>
                        </div>
                    `;
                    
                    timeline.appendChild(eventDiv);
                });
            }
            
            // Actions par √©quipe
            const teamEventsList = events.filter(e => e.isTeam === true);
            const opponentEventsList = events.filter(e => e.isTeam === false);
            
            displayTeamEvents(teamEvents, teamEventsList, true);
            displayTeamEvents(opponentEvents, opponentEventsList, false);
        }

        /**
         * Affichage des √©v√©nements d'une √©quipe
         */
        function displayTeamEvents(container, events, isTeam) {
            if (events.length === 0) {
                container.innerHTML = '<p class="no-events">Aucune action enregistr√©e</p>';
                return;
            }
            
            container.innerHTML = '';
            
            events.forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = `team-event-item ${isTeam ? 'team' : 'opponent'}`;
                
                const icon = getEventIcon(event);
                const text = getEventText(event, events);
                
                eventDiv.innerHTML = `
                    <div class="team-event-time">${event.time}</div>
                    <div class="team-event-content">
                        <span class="team-event-icon">${icon}</span>
                        <span class="team-event-text">${text}</span>
                    </div>
                `;
                
                container.appendChild(eventDiv);
            });
        }

        /**
         * Calcul et affichage des statistiques
         */
        function calculateAndDisplayStats(events) {
            const teamStats = {
                goals: 0, shots: 0, cards: 0, fouls: 0, saves: 0, freeKicks: 0
            };
            const opponentStats = {
                goals: 0, shots: 0, cards: 0, fouls: 0, saves: 0, freeKicks: 0
            };
            
            events.forEach(event => {
                const isTeam = event.isTeam === true;
                const stats = isTeam ? teamStats : opponentStats;
                
                switch (event.type) {
                    case 'goal':
                        stats.goals++;
                        break;
                    case 'shot':
                        stats.shots++;
                        break;
                    case 'card':
                        stats.cards++;
                        break;
                    case 'foul':
                        stats.fouls++;
                        break;
                    case 'save':
                        if (isTeam) stats.saves++;
                        break;
                    case 'freeKick':
                        stats.freeKicks++;
                        break;
                }
            });
            
            // Mise √† jour de l'affichage
            document.getElementById('teamGoals').textContent = teamStats.goals;
            document.getElementById('opponentGoals').textContent = opponentStats.goals;
            document.getElementById('teamShots').textContent = teamStats.shots;
            document.getElementById('opponentShots').textContent = opponentStats.shots;
            document.getElementById('teamCards').textContent = teamStats.cards;
            document.getElementById('opponentCards').textContent = opponentStats.cards;
            document.getElementById('teamFouls').textContent = teamStats.fouls;
            document.getElementById('opponentFouls').textContent = opponentStats.fouls;
            document.getElementById('teamSaves').textContent = teamStats.saves;
            document.getElementById('opponentSaves').textContent = opponentStats.saves;
            document.getElementById('teamFreeKicks').textContent = teamStats.freeKicks;
            document.getElementById('opponentFreeKicks').textContent = opponentStats.freeKicks;
        }

        /**
         * Affichage des compositions
         */
        function displayCompositions(players) {
            const teamComposition = document.getElementById('teamComposition');
            const benchComposition = document.getElementById('benchComposition');
            
            const fieldPlayers = players.filter(p => p.status === 'field');
            const benchPlayers = players.filter(p => p.status === 'bench');
            
            // Composition titulaire
            if (fieldPlayers.length > 0) {
                teamComposition.innerHTML = '';
                fieldPlayers.forEach(player => {
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'composition-player';
                    playerDiv.innerHTML = `
                        <span class="player-position">${getPositionIcon(player.position)}</span>
                        <span class="player-name">${player.name}</span>
                        ${player.number ? `<span class="player-number">${player.number}</span>` : ''}
                    `;
                    teamComposition.appendChild(playerDiv);
                });
            } else {
                teamComposition.innerHTML = '<p class="no-composition">Composition non disponible</p>';
            }
            
            // Banc de touche
            if (benchPlayers.length > 0) {
                benchComposition.innerHTML = '';
                benchPlayers.forEach(player => {
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'composition-player bench';
                    playerDiv.innerHTML = `
                        <span class="player-position">${getPositionIcon(player.position)}</span>
                        <span class="player-name">${player.name}</span>
                        ${player.number ? `<span class="player-number">${player.number}</span>` : ''}
                    `;
                    benchComposition.appendChild(playerDiv);
                });
            } else {
                benchComposition.innerHTML = '<p class="no-composition">Aucune joueuse sur le banc</p>';
            }
        }

        /**
         * Affichage des informations du match
         */
        function displayMatchInfo(config) {
            if (config.venue) {
                document.getElementById('matchVenue').textContent = config.venue;
            }
            
            if (config.matchDate) {
                const date = new Date(config.matchDate);
                document.getElementById('matchDate').textContent = date.toLocaleDateString('fr-FR');
                document.getElementById('matchStartTime').textContent = date.toLocaleTimeString('fr-FR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        /**
         * Affichage des donn√©es locales
         */
        function showLocalData() {
            const state = footballApp.getState();
            const config = getMatchConfig();
            
            const localData = {
                config: config,
                players: state.players,
                events: state.events,
                score: state.score,
                time: state.time,
                half: state.half
            };
            
            displayMatchData(localData);
            document.getElementById('liveControls').style.display = 'flex';
        }

        /**
         * Actualisation des donn√©es live
         */
        async function refreshLiveData() {
            if (!isSpectatorMode) {
                // Mode local: recharger depuis l'√©tat de l'application
                showLocalData();
                showNotification('Donn√©es locales actualis√©es', 'info');
                return;
            }
            
            // Mode spectateur: recharger depuis le serveur
            updateStatus('üîÑ Actualisation...', 'R√©cup√©ration des derni√®res donn√©es...');
            
            try {
                const matchData = await getLiveData(currentLiveId, currentBinId);
                
                if (matchData) {
                    displayMatchData(matchData);
                    updateStatus('‚úÖ Actualis√©', 'Donn√©es mises √† jour');
                    showNotification('Donn√©es actualis√©es !', 'success');
                } else {
                    throw new Error('Aucune donn√©e re√ßue');
                }
                
            } catch (error) {
                console.error('Erreur actualisation:', error);
                updateStatus('‚ùå Erreur', 'Impossible de r√©cup√©rer les donn√©es');
                showNotification('Erreur lors de l\'actualisation', 'error');
            }
        }

        /**
         * Basculer l'actualisation automatique
         */
        function toggleAutoRefresh() {
            if (autoRefreshEnabled) {
                stopAutoRefresh();
                document.getElementById('autoRefreshText').textContent = '‚ñ∂Ô∏è D√©marrer Auto';
                showNotification('Actualisation automatique arr√™t√©e', 'info');
            } else {
                startAutoRefresh();
                document.getElementById('autoRefreshText').textContent = '‚è∏Ô∏è Arr√™ter Auto';
                showNotification('Actualisation automatique activ√©e', 'success');
            }
        }

        /**
         * D√©marrage de l'actualisation automatique
         */
        function startAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            
            autoRefreshEnabled = true;
            refreshInterval = setInterval(async () => {
                if (autoRefreshEnabled) {
                    await refreshLiveData();
                }
            }, 5000); // Toutes les 5 secondes
            
            console.log('Actualisation automatique d√©marr√©e');
        }

        /**
         * Arr√™t de l'actualisation automatique
         */
        function stopAutoRefresh() {
            autoRefreshEnabled = false;
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
            }
            
            console.log('Actualisation automatique arr√™t√©e');
        }

        /**
         * Mise √† jour du statut de connexion
         */
        function updateStatus(icon, text) {
            document.getElementById('statusIcon').textContent = icon;
            document.getElementById('statusText').textContent = text;
            document.getElementById('liveStatus').textContent = text;
        }

        /**
         * Mise √† jour de l'affichage de la derni√®re mise √† jour
         */
        function updateLastUpdateDisplay() {
            if (lastUpdateTime) {
                const timeStr = lastUpdateTime.toLocaleTimeString('fr-FR');
                document.getElementById('lastUpdate').textContent = `Derni√®re mise √† jour: ${timeStr}`;
            }
        }

        /**
         * Gestion des erreurs de connexion
         */
        function handleConnectionError(message) {
            connectionAttempts++;
            
            updateStatus('‚ùå Erreur', 'Erreur de connexion');
            
            if (connectionAttempts >= maxConnectionAttempts) {
                document.getElementById('errorMessage').textContent = message;
                document.getElementById('errorModal').style.display = 'block';
                stopAutoRefresh();
            } else {
                showNotification(`Tentative ${connectionAttempts}/${maxConnectionAttempts}`, 'warning');
                setTimeout(() => {
                    loadLiveData();
                }, 3000);
            }
        }

        /**
         * Nouvelle tentative de connexion
         */
        function retryConnection() {
            closeErrorModal();
            connectionAttempts = 0;
            startAutoRefresh();
            loadLiveData();
        }

        /**
         * Fermeture de la modale d'erreur
         */
        function closeErrorModal() {
            document.getElementById('errorModal').style.display = 'none';
        }

        /**
         * Retour √† la page d'accueil
         */
        function goToHomePage() {
            window.location.href = '../index.html';
        }

        /**
         * Obtenir l'ic√¥ne d'un √©v√©nement
         */
        function getEventIcon(event) {
            const icons = {
                'goal': '‚öΩ',
                'shot': 'üéØ',
                'card': event.cardType === 'yellow' ? 'üü®' : event.cardType === 'red' ? 'üü•' : '‚ö™',
                'foul': '‚ö†Ô∏è',
                'save': 'üß§',
                'freeKick': '‚öΩ',
                'substitution': 'üîÑ',
                'halfTime': '‚è±Ô∏è',
                'timeout': '‚è∞',
                'injury': 'üè•',
                'offside': 'üö©'
            };
            return icons[event.type] || 'üìù';
        }

        /**
         * Obtenir le texte d'un √©v√©nement
         */
        function getEventText(event, allEvents) {
            // Utiliser la description directe si disponible
            if (event.description) {
                return event.description;
            }
            
            // Sinon, g√©n√©rer le texte selon le type
            const playerName = event.playerId === 'opponent' ? '√âquipe Adverse' : 
                              event.playerId ? 'Joueur' : '';
            
            switch (event.type) {
                case 'goal':
                    return `But${playerName ? ' de ' + playerName : ''}`;
                case 'shot':
                    return `Tir${playerName ? ' de ' + playerName : ''}`;
                case 'card':
                    const cardName = event.cardType === 'yellow' ? 'jaune' : 
                                   event.cardType === 'red' ? 'rouge' : 'blanc';
                    return `Carton ${cardName}${playerName ? ' pour ' + playerName : ''}`;
                case 'foul':
                    return `Faute${playerName ? ' de ' + playerName : ''}`;
                case 'save':
                    return `Arr√™t${playerName ? ' de ' + playerName : ''}`;
                case 'freeKick':
                    return `Coup de pied arr√™t√©${playerName ? ' - ' + playerName : ''}`;
                default:
                    return event.type || '√âv√©nement';
            }
        }

        /**
         * Obtenir l'ic√¥ne de position
         */
        function getPositionIcon(position) {
            const icons = {
                'gardienne': 'ü•Ö',
                'd√©fenseuse': 'üõ°Ô∏è',
                'milieu': '‚öôÔ∏è',
                'attaquante': '‚öΩ'
            };
            return icons[position] || 'üë§';
        }

        // Nettoyage lors de la fermeture de la page
        window.addEventListener('beforeunload', function() {
            stopAutoRefresh();
        });

        // Mise √† jour p√©riodique de l'affichage de la derni√®re mise √† jour
        setInterval(updateLastUpdateDisplay, 1000);
    </script>

    <style>
        /* Styles sp√©cifiques √† la page live */
        .spectator-mode .nav-tabs {
            display: none !important;
        }

        .connection-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .status-icon {
            font-size: 1.5em;
        }

        .status-text {
            font-weight: bold;
            flex: 1;
        }

        .last-update {
            font-size: 12px;
            opacity: 0.8;
        }

        .live-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .live-controls .btn {
            padding: 8px 16px;
            font-size: 14px;
        }

        .live-match-header {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            text-align: center;
            margin: 20px 0;
        }

        .live-team-info {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .live-team-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--light-color);
        }

        .live-team-score {
            font-size: 3.5em;
            font-weight: bold;
            color: var(--primary-color);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .live-match-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .live-match-time {
            font-size: 2.8em;
            font-weight: bold;
            color: var(--warning-color);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .live-match-half {
            font-size: 1.1em;
            color: var(--light-color);
        }

        .live-match-status {
            font-size: 14px;
            padding: 4px 12px;
            background: rgba(39, 174, 96, 0.3);
            border-radius: 15px;
            border: 1px solid var(--success-color);
        }

        .live-layout {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            grid-template-areas: 
                "team-left timeline team-right";
            gap: 20px;
            margin: 30px 0;
        }

        .live-timeline {
            grid-area: timeline;
        }

        .live-team-actions.left {
            grid-area: team-left;
        }

        .live-team-actions.right {
            grid-area: team-right;
        }

        .live-events-container {
            max-height: 500px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            border-radius: var(--border-radius);
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .live-event-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            margin: 8px 0;
            background: rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition);
        }

        .live-event-item:hover {
            background: rgba(255,255,255,0.15);
        }

        .live-event-item.placeholder {
            opacity: 0.6;
            font-style: italic;
        }

        .event-content {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .event-icon {
            font-size: 1.2em;
            min-width: 25px;
            text-align: center;
        }

        .event-text {
            font-weight: 500;
        }

        .live-team-actions {
            background: rgba(255,255,255,0.1);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .live-team-actions h3 {
            margin-bottom: 15px;
            text-align: center;
            color: var(--warning-color);
            border-bottom: 2px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }

        .team-events-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .team-event-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            margin: 8px 0;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .team-event-item.team {
            background: rgba(39, 174, 96, 0.2);
            border-left: 4px solid var(--success-color);
        }

        .team-event-item.opponent {
            background: rgba(231, 76, 60, 0.2);
            border-left: 4px solid var(--danger-color);
        }

        .team-event-time {
            font-weight: bold;
            min-width: 50px;
            font-size: 12px;
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .team-event-content {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .team-event-icon {
            font-size: 1.1em;
        }

        .team-event-text {
            font-size: 13px;
            font-weight: 500;
        }

        .no-events {
            text-align: center;
            font-style: italic;
            opacity: 0.7;
            padding: 20px;
        }

        .live-stats-grid {
            margin: 20px 0;
        }

        .stat-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .stat-label {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--light-color);
        }

        .stat-values {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            font-size: 1.5em;
            font-weight: bold;
        }

        .team-stat {
            color: var(--success-color);
        }

        .opponent-stat {
            color: var(--danger-color);
        }

        .stat-separator {
            color: var(--light-color);
            opacity: 0.6;
        }

        .compositions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .team-composition h4 {
            color: var(--warning-color);
            margin-bottom: 15px;
            text-align: center;
        }

        .composition-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .composition-player {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            margin: 5px 0;
            background: rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .composition-player.bench {
            background: rgba(149, 165, 166, 0.2);
            border-color: #95a5a6;
        }

        .player-position {
            font-size: 1.2em;
            min-width: 25px;
            text-align: center;
        }

        .player-name {
            flex: 1;
            font-weight: 500;
        }

        .player-number {
            font-size: 12px;
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 3px;
        }

        .no-composition {
            text-align: center;
            font-style: italic;
            opacity: 0.7;
            padding: 20px;
        }

        .match-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .info-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .info-label {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--warning-color);
        }

        .info-value {
            font-size: 16px;
            font-weight: 500;
        }

        /* Responsive pour mobile */
        @media (max-width: 768px) {
            .live-layout {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "team-left"
                    "timeline"
                    "team-right";
                gap: 15px;
            }

            .live-match-header {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .live-team-score {
                font-size: 2.5em;
            }

            .live-match-time {
                font-size: 2em;
            }

            .compositions-grid {
                grid-template-columns: 1fr;
            }

            .stat-comparison {
                grid-template-columns: repeat(2, 1fr);
            }

            .match-info-grid {
                grid-template-columns: 1fr;
            }

            .connection-indicator {
                flex-direction: column;
                text-align: center;
            }

            .live-controls {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .live-team-actions {
                padding: 15px;
            }

            .live-events-container {
                max-height: 300px;
            }

            .team-events-list {
                max-height: 250px;
            }

            .stat-comparison {
                grid-template-columns: 1fr;
            }

            .stat-values {
                font-size: 1.2em;
            }
        }
    </style>
</body>
</html>