<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Composition - Football Stats</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öΩ</text></svg>">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üìã Composition de D√©part</h1>
            <p>S√©lectionnez vos 11 titulaires pour le match</p>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <a href="../index.html" class="nav-link">üè† Accueil</a>
            <a href="team.html" class="nav-link">üë• √âquipe</a>
            <a href="composition.html" class="nav-link active">üìã Compo</a>
            <a href="match.html" class="nav-link">‚öΩ Match</a>
            <a href="live.html" class="nav-link">üì∫ Live</a>
            <a href="stats.html" class="nav-link">üìä Stats</a>
        </nav>

        <!-- Contenu principal -->
        <main class="main-content">
            
            <!-- Statut de la composition -->
            <div class="team-card">
                <h2>üéØ Statut de la Composition</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="selectedCount">0</div>
                        <div class="stat-label">Joueuses S√©lectionn√©es</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="goalkeepersSelected">0</div>
                        <div class="stat-label">Gardiennes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="defendersSelected">0</div>
                        <div class="stat-label">D√©fenseuses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="midfieldersSelected">0</div>
                        <div class="stat-label">Milieux</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="attackersSelected">0</div>
                        <div class="stat-label">Attaquantes</div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <div id="compositionStatus" class="composition-status">
                        <span class="status-icon">‚ö†Ô∏è</span>
                        <span class="status-text">S√©lectionnez 11 joueuses avec au moins 1 gardienne</span>
                    </div>
                </div>
            </div>

            <!-- S√©lection des joueuses -->
            <div class="team-card">
                <h2>üë• S√©lection des Joueuses</h2>
                <p>Cliquez sur les joueuses pour les ajouter/retirer de la composition de d√©part :</p>
                
                <div id="playersSelectionGrid" class="player-grid">
                    <!-- Les joueuses appara√Ætront ici -->
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="clearSelection()">üîÑ Tout D√©s√©lectionner</button>
                    <button class="btn btn-warning" onclick="autoSelectComposition()">üé≤ S√©lection Auto</button>
                    <button class="btn btn-primary" id="validateBtn" onclick="validateComposition()" disabled>
                        ‚úÖ Valider la Composition
                    </button>
                </div>
            </div>

            <!-- Aper√ßu de la composition -->
            <div class="team-card">
                <h2>üèüÔ∏è Aper√ßu de la Composition</h2>
                
                <!-- Formation visuelle -->
                <div class="formation-display">
                    <div class="field">
                        <!-- Gardienne -->
                        <div class="field-line goalkeeper-line">
                            <div class="field-position" id="gk-position">
                                <div class="position-label">Gardienne</div>
                                <div class="players-in-position" id="gk-players"></div>
                            </div>
                        </div>
                        
                        <!-- D√©fense -->
                        <div class="field-line defense-line">
                            <div class="field-position" id="def-position">
                                <div class="position-label">D√©fense</div>
                                <div class="players-in-position" id="def-players"></div>
                            </div>
                        </div>
                        
                        <!-- Milieu -->
                        <div class="field-line midfield-line">
                            <div class="field-position" id="mid-position">
                                <div class="position-label">Milieu</div>
                                <div class="players-in-position" id="mid-players"></div>
                            </div>
                        </div>
                        
                        <!-- Attaque -->
                        <div class="field-line attack-line">
                            <div class="field-position" id="att-position">
                                <div class="position-label">Attaque</div>
                                <div class="players-in-position" id="att-players"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Liste des titulaires -->
                <div class="starting-eleven-list">
                    <h3>üìù 11 de D√©part</h3>
                    <div id="startingElevenList" class="players-list">
                        <p>Aucune joueuse s√©lectionn√©e</p>
                    </div>
                </div>
                
                <!-- Banc de touche -->
                <div class="bench-list">
                    <h3>ü™ë Banc de Touche</h3>
                    <div id="benchList" class="players-list">
                        <p>Aucune joueuse sur le banc</p>
                    </div>
                </div>
            </div>

            <!-- Formations pr√©d√©finies -->
            <div class="team-card">
                <h2>‚öôÔ∏è Formations Pr√©d√©finies</h2>
                <p>S√©lectionnez une formation classique :</p>
                
                <div class="formations-grid">
                    <button class="formation-btn" onclick="applyFormation('4-4-2')">
                        <div class="formation-name">4-4-2</div>
                        <div class="formation-desc">√âquilibr√©e</div>
                    </button>
                    <button class="formation-btn" onclick="applyFormation('4-3-3')">
                        <div class="formation-name">4-3-3</div>
                        <div class="formation-desc">Offensive</div>
                    </button>
                    <button class="formation-btn" onclick="applyFormation('3-5-2')">
                        <div class="formation-name">3-5-2</div>
                        <div class="formation-desc">Milieu renforc√©</div>
                    </button>
                    <button class="formation-btn" onclick="applyFormation('5-3-2')">
                        <div class="formation-name">5-3-2</div>
                        <div class="formation-desc">D√©fensive</div>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Validation -->
    <div id="validationModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeValidationModal()">&times;</span>
            <h3>‚úÖ Composition Valid√©e</h3>
            <p>Votre composition de d√©part a √©t√© valid√©e avec succ√®s !</p>
            
            <div id="validatedComposition" style="margin: 20px 0;">
                <!-- R√©sum√© de la composition -->
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="goToMatch()">‚öΩ Aller au Match</button>
                <button class="btn btn-secondary" onclick="closeValidationModal()">üìù Continuer l'√âdition</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/storage.js"></script>
    <script src="../js/app.js"></script>
    <script>
        // Variables locales
        let selectedPlayers = [];

        // Initialisation de la page
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentComposition();
            updatePlayersSelectionDisplay();
            updateCompositionStats();
            updateFormationDisplay();
        });

        /**
         * Chargement de la composition actuelle
         */
        function loadCurrentComposition() {
            const players = footballApp.getState().players;
            selectedPlayers = players.filter(p => p.status === 'field').map(p => p.id);
            console.log('Composition charg√©e:', selectedPlayers);
        }

        /**
         * Mise √† jour de l'affichage de s√©lection
         */
        function updatePlayersSelectionDisplay() {
            const container = document.getElementById('playersSelectionGrid');
            const players = footballApp.getState().players;

            if (players.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune joueuse disponible. <a href="team.html">Cr√©ez votre √©quipe d\'abord</a>.</p>';
                return;
            }

            container.innerHTML = '';

            // Regrouper par position
            const positions = ['gardienne', 'd√©fenseuse', 'milieu', 'attaquante'];
            
            positions.forEach(position => {
                const positionPlayers = players.filter(p => p.position === position);
                
                if (positionPlayers.length > 0) {
                    // Titre de position
                    const positionTitle = document.createElement('div');
                    positionTitle.className = 'position-section-title';
                    positionTitle.innerHTML = `
                        <h3 style="grid-column: 1 / -1; margin: 20px 0 10px; color: var(--warning-color);">
                            ${footballApp.getPositionIcon(position)} ${position.charAt(0).toUpperCase() + position.slice(1)}s
                        </h3>
                    `;
                    container.appendChild(positionTitle);
                    
                    // Joueuses de cette position
                    positionPlayers.forEach(player => {
                        const playerCard = createSelectablePlayerCard(player);
                        container.appendChild(playerCard);
                    });
                }
            });
        }

        /**
         * Cr√©ation d'une carte joueuse s√©lectionnable
         */
        function createSelectablePlayerCard(player) {
            const isSelected = selectedPlayers.includes(player.id);
            const isDisabled = player.status === 'sanctioned';
            
            const card = document.createElement('div');
            card.className = `player-btn ${player.position === 'gardienne' ? 'goalkeeper' : ''} ${isSelected ? 'selected' : ''} ${isDisabled ? 'sanctioned' : ''}`;
            
            if (isDisabled) {
                card.style.opacity = '0.5';
                card.style.cursor = 'not-allowed';
            } else {
                card.onclick = () => togglePlayerSelection(player.id);
            }

            card.innerHTML = `
                <div style="font-size: 1.5em;">${footballApp.getPositionIcon(player.position)}</div>
                <div style="font-weight: bold; margin: 5px 0;">${player.name}</div>
                ${player.number ? `<div style="font-size: 12px; color: var(--warning-color);">N¬∞ ${player.number}</div>` : ''}
                <div style="font-size: 11px; margin: 5px 0;">
                    ${isSelected ? '‚úÖ Titulaire' : isDisabled ? '‚ö†Ô∏è Sanctionn√©e' : 'ü™ë Disponible'}
                </div>
                <div style="font-size: 10px; opacity: 0.8;">
                    ‚öΩ ${player.stats.goals} | üéØ ${player.stats.shots}
                </div>
            `;

            return card;
        }

        /**
         * Basculer la s√©lection d'une joueuse
         */
        function togglePlayerSelection(playerId) {
            const player = footballApp.getState().players.find(p => p.id === playerId);
            
            if (!player || player.status === 'sanctioned') {
                return;
            }

            const isSelected = selectedPlayers.includes(playerId);
            
            if (isSelected) {
                // Retirer de la s√©lection
                selectedPlayers = selectedPlayers.filter(id => id !== playerId);
                footballApp.updatePlayerStatus(playerId, 'bench');
            } else {
                // Ajouter √† la s√©lection
                if (selectedPlayers.length >= 11) {
                    showNotification('Vous avez d√©j√† s√©lectionn√© 11 joueuses', 'warning');
                    return;
                }
                
                // V√©rifier qu'il n'y ait qu'une seule gardienne
                if (player.position === 'gardienne') {
                    const selectedGoalkeepers = selectedPlayers.filter(id => {
                        const p = footballApp.getState().players.find(pl => pl.id === id);
                        return p && p.position === 'gardienne';
                    });
                    
                    if (selectedGoalkeepers.length > 0) {
                        showNotification('Il ne peut y avoir qu\'une seule gardienne titulaire', 'warning');
                        return;
                    }
                }
                
                selectedPlayers.push(playerId);
                footballApp.updatePlayerStatus(playerId, 'field');
            }

            updatePlayersSelectionDisplay();
            updateCompositionStats();
            updateFormationDisplay();
            updateValidationButton();
            
            console.log('S√©lection mise √† jour:', selectedPlayers);
        }

        /**
         * Mise √† jour des statistiques de composition
         */
        function updateCompositionStats() {
            const players = footballApp.getState().players;
            const selected = selectedPlayers.map(id => players.find(p => p.id === id)).filter(Boolean);
            
            document.getElementById('selectedCount').textContent = selected.length;
            document.getElementById('goalkeepersSelected').textContent = selected.filter(p => p.position === 'gardienne').length;
            document.getElementById('defendersSelected').textContent = selected.filter(p => p.position === 'd√©fenseuse').length;
            document.getElementById('midfieldersSelected').textContent = selected.filter(p => p.position === 'milieu').length;
            document.getElementById('attackersSelected').textContent = selected.filter(p => p.position === 'attaquante').length;
            
            // Mise √† jour du statut
            updateCompositionStatus(selected);
        }

        /**
         * Mise √† jour du statut de composition
         */
        function updateCompositionStatus(selected) {
            const statusEl = document.getElementById('compositionStatus');
            const goalkeepers = selected.filter(p => p.position === 'gardienne').length;
            
            if (selected.length === 0) {
                statusEl.innerHTML = '<span class="status-icon">‚ö†Ô∏è</span><span class="status-text">Aucune joueuse s√©lectionn√©e</span>';
                statusEl.className = 'composition-status warning';
            } else if (selected.length < 11) {
                statusEl.innerHTML = `<span class="status-icon">‚ö†Ô∏è</span><span class="status-text">Il manque ${11 - selected.length} joueuse(s)</span>`;
                statusEl.className = 'composition-status warning';
            } else if (selected.length === 11 && goalkeepers === 0) {
                statusEl.innerHTML = '<span class="status-icon">‚ùå</span><span class="status-text">Aucune gardienne s√©lectionn√©e</span>';
                statusEl.className = 'composition-status error';
            } else if (selected.length === 11 && goalkeepers === 1) {
                statusEl.innerHTML = '<span class="status-icon">‚úÖ</span><span class="status-text">Composition valide et pr√™te !</span>';
                statusEl.className = 'composition-status success';
            } else {
                statusEl.innerHTML = '<span class="status-icon">‚ùå</span><span class="status-text">Trop de joueuses s√©lectionn√©es</span>';
                statusEl.className = 'composition-status error';
            }
        }

        /**
         * Mise √† jour de l'affichage de formation
         */
        function updateFormationDisplay() {
            const players = footballApp.getState().players;
            const selected = selectedPlayers.map(id => players.find(p => p.id === id)).filter(Boolean);
            
            // R√©partir par position
            const positions = {
                gardienne: selected.filter(p => p.position === 'gardienne'),
                d√©fenseuse: selected.filter(p => p.position === 'd√©fenseuse'),
                milieu: selected.filter(p => p.position === 'milieu'),
                attaquante: selected.filter(p => p.position === 'attaquante')
            };

            // Mettre √† jour l'affichage visuel
            updatePositionDisplay('gk', positions.gardienne);
            updatePositionDisplay('def', positions.d√©fenseuse);
            updatePositionDisplay('mid', positions.milieu);
            updatePositionDisplay('att', positions.attaquante);
            
            // Mettre √† jour les listes
            updateStartingElevenList(selected);
            updateBenchList();
        }

        /**
         * Mise √† jour de l'affichage d'une position
         */
        function updatePositionDisplay(position, players) {
            const container = document.getElementById(`${position}-players`);
            
            if (players.length === 0) {
                container.innerHTML = '<div class="empty-position">Aucune joueuse</div>';
                return;
            }

            container.innerHTML = '';
            players.forEach(player => {
                const playerEl = document.createElement('div');
                playerEl.className = 'field-player';
                playerEl.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    ${player.number ? `<div class="player-number">${player.number}</div>` : ''}
                `;
                container.appendChild(playerEl);
            });
        }

        /**
         * Mise √† jour de la liste des titulaires
         */
        function updateStartingElevenList(selected) {
            const container = document.getElementById('startingElevenList');
            
            if (selected.length === 0) {
                container.innerHTML = '<p>Aucune joueuse s√©lectionn√©e</p>';
                return;
            }

            container.innerHTML = '';
            
            // Regrouper par position
            const positions = ['gardienne', 'd√©fenseuse', 'milieu', 'attaquante'];
            
            positions.forEach(position => {
                const positionPlayers = selected.filter(p => p.position === position);
                
                if (positionPlayers.length > 0) {
                    const positionDiv = document.createElement('div');
                    positionDiv.className = 'position-group';
                    positionDiv.innerHTML = `
                        <h4>${footballApp.getPositionIcon(position)} ${position.charAt(0).toUpperCase() + position.slice(1)}s (${positionPlayers.length})</h4>
                        <ul>
                            ${positionPlayers.map(p => `<li>${p.name}${p.number ? ` (${p.number})` : ''}</li>`).join('')}
                        </ul>
                    `;
                    container.appendChild(positionDiv);
                }
            });
        }

        /**
         * Mise √† jour de la liste du banc
         */
        function updateBenchList() {
            const container = document.getElementById('benchList');
            const players = footballApp.getState().players;
            const benchPlayers = players.filter(p => p.status === 'bench' && !selectedPlayers.includes(p.id));
            
            if (benchPlayers.length === 0) {
                container.innerHTML = '<p>Aucune joueuse sur le banc</p>';
                return;
            }

            container.innerHTML = '';
            const benchList = document.createElement('ul');
            
            benchPlayers.forEach(player => {
                const li = document.createElement('li');
                li.innerHTML = `${footballApp.getPositionIcon(player.position)} ${player.name}${player.number ? ` (${player.number})` : ''}`;
                benchList.appendChild(li);
            });
            
            container.appendChild(benchList);
        }

        /**
         * Mise √† jour du bouton de validation
         */
        function updateValidationButton() {
            const btn = document.getElementById('validateBtn');
            const players = footballApp.getState().players;
            const selected = selectedPlayers.map(id => players.find(p => p.id === id)).filter(Boolean);
            const goalkeepers = selected.filter(p => p.position === 'gardienne').length;
            
            const isValid = selected.length === 11 && goalkeepers === 1;
            btn.disabled = !isValid;
            
            if (isValid) {
                btn.className = 'btn btn-success';
                btn.innerHTML = '‚úÖ Valider la Composition';
            } else {
                btn.className = 'btn btn-primary';
                btn.innerHTML = '‚ö†Ô∏è Composition Incompl√®te';
            }
        }

        /**
         * Effacer la s√©lection
         */
        function clearSelection() {
            if (selectedPlayers.length === 0) {
                showNotification('Aucune joueuse √† d√©s√©lectionner', 'info');
                return;
            }

            if (confirm('D√©s√©lectionner toutes les joueuses ?')) {
                selectedPlayers.forEach(playerId => {
                    footballApp.updatePlayerStatus(playerId, 'bench');
                });
                
                selectedPlayers = [];
                
                updatePlayersSelectionDisplay();
                updateCompositionStats();
                updateFormationDisplay();
                updateValidationButton();
                
                showNotification('S√©lection effac√©e');
            }
        }

        /**
         * S√©lection automatique
         */
        function autoSelectComposition() {
            const players = footballApp.getState().players;
            const availablePlayers = players.filter(p => p.status !== 'sanctioned');
            
            if (availablePlayers.length < 11) {
                showNotification(`Il faut au moins 11 joueuses disponibles (${availablePlayers.length} actuellement)`, 'error');
                return;
            }

            const goalkeepers = availablePlayers.filter(p => p.position === 'gardienne');
            if (goalkeepers.length === 0) {
                showNotification('Aucune gardienne disponible', 'error');
                return;
            }

            if (confirm('S√©lectionner automatiquement une composition √©quilibr√©e ?')) {
                // Effacer la s√©lection actuelle
                selectedPlayers.forEach(playerId => {
                    footballApp.updatePlayerStatus(playerId, 'bench');
                });
                selectedPlayers = [];

                // S√©lection automatique
                const selected = [];

                // 1 gardienne
                selected.push(goalkeepers[0]);

                // Autres positions
                const fieldPlayers = availablePlayers.filter(p => p.position !== 'gardienne');
                const positions = ['d√©fenseuse', 'milieu', 'attaquante'];
                
                // R√©partition √©quilibr√©e: 4 d√©fenseuses, 3 milieux, 3 attaquantes
                const distribution = { d√©fenseuse: 4, milieu: 3, attaquante: 3 };
                
                positions.forEach(position => {
                    const positionPlayers = fieldPlayers.filter(p => p.position === position);
                    const needed = distribution[position];
                    
                    for (let i = 0; i < Math.min(needed, positionPlayers.length); i++) {
                        if (selected.length < 11) {
                            selected.push(positionPlayers[i]);
                        }
                    }
                });

                // Compl√©ter si n√©cessaire
                while (selected.length < 11 && fieldPlayers.length > 0) {
                    const remaining = fieldPlayers.filter(p => !selected.includes(p));
                    if (remaining.length > 0) {
                        selected.push(remaining[0]);
                    } else {
                        break;
                    }
                }

                // Appliquer la s√©lection
                selected.forEach(player => {
                    selectedPlayers.push(player.id);
                    footballApp.updatePlayerStatus(player.id, 'field');
                });

                updatePlayersSelectionDisplay();
                updateCompositionStats();
                updateFormationDisplay();
                updateValidationButton();
                
                showNotification(`Composition automatique cr√©√©e (${selected.length} joueuses)`);
            }
        }

        /**
         * Application d'une formation pr√©d√©finie
         */
        function applyFormation(formation) {
            const players = footballApp.getState().players;
            const availablePlayers = players.filter(p => p.status !== 'sanctioned');
            
            const formations = {
                '4-4-2': { d√©fenseuse: 4, milieu: 4, attaquante: 2 },
                '4-3-3': { d√©fenseuse: 4, milieu: 3, attaquante: 3 },
                '3-5-2': { d√©fenseuse: 3, milieu: 5, attaquante: 2 },
                '5-3-2': { d√©fenseuse: 5, milieu: 3, attaquante: 2 }
            };

            const config = formations[formation];
            if (!config) return;

            // V√©rifier les disponibilit√©s
            const goalkeepers = availablePlayers.filter(p => p.position === 'gardienne');
            if (goalkeepers.length === 0) {
                showNotification('Aucune gardienne disponible', 'error');
                return;
            }

            let canApply = true;
            let message = `Formation ${formation}:\n`;
            
            Object.entries(config).forEach(([position, needed]) => {
                const available = availablePlayers.filter(p => p.position === position).length;
                message += `- ${position}s: ${needed} requis, ${available} disponibles\n`;
                if (available < needed) {
                    canApply = false;
                }
            });

            if (!canApply) {
                alert(`Impossible d'appliquer la formation ${formation}:\n\n${message}`);
                return;
            }

            if (confirm(`Appliquer la formation ${formation} ?\n\n${message}`)) {
                // Effacer la s√©lection actuelle
                selectedPlayers.forEach(playerId => {
                    footballApp.updatePlayerStatus(playerId, 'bench');
                });
                selectedPlayers = [];

                // Appliquer la nouvelle formation
                const selected = [];
                
                // 1 gardienne
                selected.push(goalkeepers[0]);
                
                // Autres positions selon la formation
                Object.entries(config).forEach(([position, needed]) => {
                    const positionPlayers = availablePlayers.filter(p => p.position === position);
                    for (let i = 0; i < needed && i < positionPlayers.length; i++) {
                        selected.push(positionPlayers[i]);
                    }
                });

                // Appliquer la s√©lection
                selected.forEach(player => {
                    selectedPlayers.push(player.id);
                    footballApp.updatePlayerStatus(player.id, 'field');
                });

                updatePlayersSelectionDisplay();
                updateCompositionStats();
                updateFormationDisplay();
                updateValidationButton();
                
                showNotification(`Formation ${formation} appliqu√©e !`);
            }
        }

        /**
         * Validation de la composition
         */
        function validateComposition() {
            const players = footballApp.getState().players;
            const selected = selectedPlayers.map(id => players.find(p => p.id === id)).filter(Boolean);
            const goalkeepers = selected.filter(p => p.position === 'gardienne').length;
            
            if (selected.length !== 11) {
                showNotification(`Il faut exactement 11 joueuses (${selected.length} s√©lectionn√©es)`, 'error');
                return;
            }

            if (goalkeepers !== 1) {
                showNotification('Il faut exactement 1 gardienne', 'error');
                return;
            }

            // Sauvegarder la composition
            footballApp.saveState();
            
            // Afficher le r√©sum√©
            displayValidationSummary(selected);
            document.getElementById('validationModal').style.display = 'block';
        }

        /**
         * Affichage du r√©sum√© de validation
         */
        function displayValidationSummary(selected) {
            const container = document.getElementById('validatedComposition');
            
            const positions = {
                gardienne: selected.filter(p => p.position === 'gardienne'),
                d√©fenseuse: selected.filter(p => p.position === 'd√©fenseuse'),
                milieu: selected.filter(p => p.position === 'milieu'),
                attaquante: selected.filter(p => p.position === 'attaquante')
            };

            const formation = `${positions.d√©fenseuse.length}-${positions.milieu.length}-${positions.attaquante.length}`;

            container.innerHTML = `
                <div class="formation-summary">
                    <h4>Formation: ${formation}</h4>
                    <div class="position-summary">
                        <div><strong>ü•Ö Gardienne:</strong> ${positions.gardienne.map(p => p.name).join(', ')}</div>
                        <div><strong>üõ°Ô∏è D√©fense (${positions.d√©fenseuse.length}):</strong> ${positions.d√©fenseuse.map(p => p.name).join(', ')}</div>
                        <div><strong>‚öôÔ∏è Milieu (${positions.milieu.length}):</strong> ${positions.milieu.map(p => p.name).join(', ')}</div>
                        <div><strong>‚öΩ Attaque (${positions.attaquante.length}):</strong> ${positions.attaquante.map(p => p.name).join(', ')}</div>
                    </div>
                </div>
            `;
        }

        /**
         * Fermeture de la modale de validation
         */
        function closeValidationModal() {
            document.getElementById('validationModal').style.display = 'none';
        }

        /**
         * Aller au match
         */
        function goToMatch() {
            showNotification('Redirection vers l\'interface de match...', 'success');
            setTimeout(() => {
                window.location.href = 'match.html';
            }, 1500);
        }

        // Fonction sp√©cialis√©e pour cette page
        function updateSpecificPlayersDisplay() {
            loadCurrentComposition();
            updatePlayersSelectionDisplay();
            updateCompositionStats();
            updateFormationDisplay();
            updateValidationButton();
        }
    </script>

    <style>
        /* Styles sp√©cifiques √† la page composition */
        .composition-status {
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 10px 0;
            text-align: center;
            font-weight: 600;
        }

        .composition-status.success {
            background: rgba(39, 174, 96, 0.2);
            border: 2px solid var(--success-color);
            color: var(--success-color);
        }

        .composition-status.warning {
            background: rgba(243, 156, 18, 0.2);
            border: 2px solid var(--warning-color);
            color: var(--warning-color);
        }

        .composition-status.error {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid var(--danger-color);
            color: var(--danger-color);
        }

        .formation-display {
            margin: 20px 0;
            background: rgba(34, 139, 34, 0.1);
            border-radius: var(--border-radius-lg);
            padding: 20px;
        }

        .field {
            background: linear-gradient(to bottom, #2d8a2f, #1a5f1d);
            border-radius: var(--border-radius);
            padding: 20px;
            min-height: 400px;
            position: relative;
            border: 3px solid white;
        }

        .field-line {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            min-height: 80px;
        }

        .field-position {
            text-align: center;
            width: 100%;
        }

        .position-label {
            font-weight: bold;
            margin-bottom: 10px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .players-in-position {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .field-player {
            background: rgba(255,255,255,0.9);
            color: #2c3e50;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            min-width: 60px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .player-name {
            font-size: 11px;
        }

        .player-number {
            font-size: 10px;
            opacity: 0.8;
        }

        .empty-position {
            color: rgba(255,255,255,0.6);
            font-style: italic;
            font-size: 12px;
        }

        .starting-eleven-list,
        .bench-list {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
        }

        .players-list {
            margin-top: 10px;
        }

        .position-group {
            margin: 10px 0;
        }

        .position-group h4 {
            color: var(--warning-color);
            margin-bottom: 5px;
        }

        .position-group ul {
            list-style: none;
            padding-left: 0;
        }

        .position-group li {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .formations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .formation-btn {
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: var(--border-radius);
            color: white;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .formation-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .formation-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .formation-desc {
            font-size: 12px;
            opacity: 0.8;
        }

        .formation-summary {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
        }

        .position-summary div {
            margin: 10px 0;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }

        @media (max-width: 768px) {
            .field {
                min-height: 300px;
                padding: 15px;
            }

            .field-line {
                margin: 15px 0;
                min-height: 60px;
            }

            .field-player {
                padding: 6px 10px;
                font-size: 10px;
                min-width: 50px;
            }

            .formations-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</body>
</html>