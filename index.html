<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Stats - Manager</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öΩ</text></svg>">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>‚öΩ Football Stats Manager</h1>
            <p>Gestion compl√®te des statistiques de match</p>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <a href="index.html" class="nav-link active">üè† Accueil</a>
            <a href="pages/team.html" class="nav-link">üë• √âquipe</a>
            <a href="pages/composition.html" class="nav-link">üìã Compo</a>
            <a href="pages/match.html" class="nav-link">‚öΩ Match</a>
            <a href="pages/live.html" class="nav-link">üì∫ Live</a>
            <a href="pages/stats.html" class="nav-link">üìä Stats</a>
        </nav>

        <!-- Page d'accueil -->
        <main class="main-content">
            <div class="team-card">
                <h2>üéÆ Actions Rapides</h2>
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="footballApp.startNewMatch()">
                        üÜï Nouveau Match
                    </button>
                    <button class="btn btn-secondary" onclick="showConfirmReset()">
                        üîÑ Reset Complet
                    </button>
                    <button class="btn btn-warning" onclick="loadMatchFile()">
                        üìÇ Charger Sauvegarde
                    </button>
                    <button class="btn btn-success" onclick="downloadCurrentMatch()">
                        üíæ Sauvegarder Match
                    </button>
                </div>
                <input type="file" id="fileInput" accept=".json" style="display: none;">
            </div>

            <div class="team-card">
                <h2>üìã Configuration du Match</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="teamName">Nom de votre √©quipe :</label>
                        <input type="text" id="teamName" placeholder="Mon √âquipe" maxlength="30">
                    </div>
                    <div class="form-group">
                        <label for="opponentName">√âquipe adverse :</label>
                        <input type="text" id="opponentName" placeholder="√âquipe Adverse" maxlength="30">
                    </div>
                    <div class="form-group">
                        <label for="venue">Lieu du match :</label>
                        <input type="text" id="venue" placeholder="Stade Municipal" maxlength="50">
                    </div>
                    <div class="form-group">
                        <label for="matchDate">Date et heure :</label>
                        <input type="datetime-local" id="matchDate">
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="saveMatchConfig()">üíæ Sauvegarder Configuration</button>
                </div>
            </div>

            <div class="team-card">
                <h2>üìä Aper√ßu Rapide</h2>
                <div id="recentStats" class="stats-preview">
                    <p>Commencez par cr√©er votre √©quipe !</p>
                </div>
            </div>

            <div class="team-card">
                <h2>üìñ Guide Rapide</h2>
                <div class="guide-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Cr√©er l'√©quipe</h3>
                            <p>Ajoutez vos joueuses dans la section "√âquipe"</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>S√©lectionner la composition</h3>
                            <p>Choisissez vos 11 titulaires dans "Compo"</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>Lancer le match</h3>
                            <p>Utilisez l'interface "Match" pour suivre le jeu</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3>Partager en live</h3>
                            <p>G√©n√©rez un lien pour que d'autres suivent le match</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Confirmation Reset -->
    <div id="confirmResetModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeConfirmReset()">&times;</span>
            <h3>‚ö†Ô∏è Confirmation Reset</h3>
            <p>√ätes-vous s√ªr de vouloir effacer toutes les donn√©es ?</p>
            <p style="color: #e74c3c;">Cette action est irr√©versible !</p>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="confirmReset()">‚úÖ Oui, effacer tout</button>
                <button class="btn btn-secondary" onclick="closeConfirmReset()">‚ùå Annuler</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/storage.js"></script>
    <script src="js/app.js"></script>
    <script>
        // ===== FONCTIONS SP√âCIFIQUES √Ä LA PAGE INDEX =====
        
        /**
         * Initialisation de la page d'accueil
         */
        document.addEventListener('DOMContentLoaded', function() {
            loadMatchConfig();
            
            // Attendre que footballApp soit charg√©
            setTimeout(() => {
                updateRecentStats();
            }, 100);
            
            // Configuration de la date par d√©faut
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('matchDate').value = now.toISOString().slice(0, 16);
        });

        /**
         * Afficher la modal de confirmation de reset
         */
        function showConfirmReset() {
            document.getElementById('confirmResetModal').style.display = 'block';
        }

        /**
         * Fermer la modal de confirmation
         */
        function closeConfirmReset() {
            document.getElementById('confirmResetModal').style.display = 'none';
        }

        /**
         * Confirmer le reset complet
         */
        function confirmReset() {
            closeConfirmReset();
            footballApp.resetCompleteApp();
        }

        /**
         * Sauvegarder la configuration du match
         */
        function saveMatchConfig() {
            const config = getMatchConfig();
            if (typeof setMatchConfig === 'function') {
                setMatchConfig(config);
            }
            
            if (typeof footballApp !== 'undefined' && footballApp.showNotification) {
                footballApp.showNotification('üíæ Configuration sauvegard√©e !', 'success');
            } else {
                alert('üíæ Configuration sauvegard√©e !');
            }
        }

        /**
         * Obtenir la configuration du match depuis les champs
         */
        function getMatchConfig() {
            return {
                teamName: document.getElementById('teamName').value.trim() || 'Mon √âquipe',
                opponentName: document.getElementById('opponentName').value.trim() || '√âquipe Adverse',
                venue: document.getElementById('venue').value.trim() || 'Stade Municipal',
                matchDate: document.getElementById('matchDate').value
            };
        }

        /**
         * Charger la configuration du match dans les champs
         */
        function loadMatchConfig() {
            const config = getMatchConfig();
            let saved = null;
            
            // Essayer de charger depuis storage.js
            if (typeof loadData === 'function') {
                saved = loadData('matchConfig');
            }
            
            if (saved) {
                document.getElementById('teamName').value = saved.teamName || config.teamName;
                document.getElementById('opponentName').value = saved.opponentName || config.opponentName;
                document.getElementById('venue').value = saved.venue || config.venue;
                if (saved.matchDate) {
                    document.getElementById('matchDate').value = saved.matchDate;
                }
            }
        }

        /**
         * Mettre √† jour les statistiques affich√©es
         */
        function updateRecentStats() {
            const container = document.getElementById('recentStats');
            
            // V√©rifier que footballApp est disponible
            if (typeof footballApp === 'undefined' || !footballApp.getHomePageStats) {
                container.innerHTML = '<p>Chargement des statistiques...</p>';
                return;
            }
            
            const stats = footballApp.getHomePageStats();
            
            if (!stats.hasData) {
                container.innerHTML = '<p>Aucune donn√©e disponible. Commencez par cr√©er votre √©quipe !</p>';
                return;
            }
            
            let html = '<div class="stats-summary">';
            
            // Statistiques des joueurs
            if (stats.players.total > 0) {
                html += `
                    <div class="stat-item">
                        <span class="stat-icon">üë•</span>
                        <span class="stat-text">${stats.players.total} joueuses</span>
                        <span class="stat-detail">(${stats.players.field} titulaires, ${stats.players.bench} rempla√ßantes)</span>
                    </div>
                `;
            }
            
            // Statistiques du match actuel
            if (stats.match) {
                html += `
                    <div class="stat-item">
                        <span class="stat-icon">‚öΩ</span>
                        <span class="stat-text">Match en cours</span>
                        <span class="stat-detail">Score: ${stats.match.score.team}-${stats.match.score.opponent}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">üìù</span>
                        <span class="stat-text">${stats.match.events} √©v√©nements</span>
                        <span class="stat-detail">${stats.match.half}√®me mi-temps</span>
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        /**
         * T√©l√©charger les donn√©es du match actuel
         */
        function downloadCurrentMatch() {
            try {
                if (typeof footballApp === 'undefined' || !footballApp.exportCurrentMatch) {
                    alert('‚ùå Application non charg√©e, veuillez r√©essayer');
                    return;
                }
                
                const exportData = footballApp.exportCurrentMatch();
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `football-stats-${new Date().toISOString().slice(0, 10)}.json`;
                link.click();
                
                if (footballApp.showNotification) {
                    footballApp.showNotification('üíæ Sauvegarde t√©l√©charg√©e !', 'success');
                } else {
                    alert('üíæ Sauvegarde t√©l√©charg√©e !');
                }
            } catch (error) {
                console.error('Erreur export:', error);
                if (typeof footballApp !== 'undefined' && footballApp.showNotification) {
                    footballApp.showNotification('‚ùå Erreur lors de l\'export', 'error');
                } else {
                    alert('‚ùå Erreur lors de l\'export');
                }
            }
        }

        /**
         * Charger un fichier de match
         */
        function loadMatchFile() {
            document.getElementById('fileInput').click();
        }

        /**
         * Gestionnaire de fichier
         */
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('üìÇ Charger cette sauvegarde ?\n\n‚ö†Ô∏è Les donn√©es actuelles seront remplac√©es !')) {
                        if (typeof footballApp === 'undefined' || !footballApp.importMatchData) {
                            alert('‚ùå Application non charg√©e, veuillez recharger la page');
                            return;
                        }
                        
                        const success = footballApp.importMatchData(data);
                        
                        if (success) {
                            if (footballApp.showNotification) {
                                footballApp.showNotification('üìÇ Sauvegarde charg√©e avec succ√®s !', 'success');
                            } else {
                                alert('üìÇ Sauvegarde charg√©e avec succ√®s !');
                            }
                            updateRecentStats();
                            loadMatchConfig();
                        } else {
                            if (footballApp.showNotification) {
                                footballApp.showNotification('‚ùå Erreur lors du chargement', 'error');
                            } else {
                                alert('‚ùå Erreur lors du chargement');
                            }
                        }
                    }
                } catch (error) {
                    console.error('Erreur lors du chargement:', error);
                    if (typeof footballApp !== 'undefined' && footballApp.showNotification) {
                        footballApp.showNotification('‚ùå Erreur: fichier invalide', 'error');
                    } else {
                        alert('‚ùå Erreur: fichier invalide');
                    }
                }
            };
            reader.readAsText(file);
            
            // Reset input
            event.target.value = '';
        });
    </script>
</body>
</html>