<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Stats - Manager</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öΩ</text></svg>">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>‚öΩ Football Stats Manager</h1>
            <p>Gestion compl√®te des statistiques de match</p>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <a href="index.html" class="nav-link active">üè† Accueil</a>
            <a href="pages/team.html" class="nav-link">üë• √âquipe</a>
            <a href="pages/composition.html" class="nav-link">üìã Compo</a>
            <a href="pages/match.html" class="nav-link">‚öΩ Match</a>
            <a href="pages/live.html" class="nav-link">üì∫ Live</a>
            <a href="pages/stats.html" class="nav-link">üìä Stats</a>
        </nav>

        <!-- Page d'accueil -->
        <main class="main-content">
            <div class="team-card">
                <h2>üéÆ Actions Rapides</h2>
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="startNewMatch()">
                        üÜï Nouveau Match
                    </button>
                    <button class="btn btn-secondary" onclick="showConfirmReset()">
                        üîÑ Reset Complet
                    </button>
                    <button class="btn btn-warning" onclick="loadMatchFile()">
                        üìÇ Charger Sauvegarde
                    </button>
                    <button class="btn btn-success" onclick="downloadCurrentMatch()">
                        üíæ Sauvegarder Match
                    </button>
                </div>
                <input type="file" id="fileInput" accept=".json" style="display: none;">
            </div>

            <div class="team-card">
                <h2>üìã Configuration du Match</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="teamName">Nom de votre √©quipe :</label>
                        <input type="text" id="teamName" placeholder="Mon √âquipe">
                    </div>
                    <div class="form-group">
                        <label for="opponentName">√âquipe adverse :</label>
                        <input type="text" id="opponentName" placeholder="√âquipe Adverse">
                    </div>
                    <div class="form-group">
                        <label for="venue">Lieu du match :</label>
                        <input type="text" id="venue" placeholder="Stade Municipal">
                    </div>
                    <div class="form-group">
                        <label for="matchDate">Date du match :</label>
                        <input type="datetime-local" id="matchDate">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="saveMatchConfig()">üíæ Sauvegarder Configuration</button>
            </div>

            <div class="team-card">
                <h2>üìä Statistiques R√©centes</h2>
                <div id="recentStats" class="stats-preview">
                    <p>Aucune donn√©e disponible. Commencez par cr√©er votre √©quipe !</p>
                </div>
            </div>

            <div class="team-card">
                <h2>üìñ Guide Rapide</h2>
                <div class="guide-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Cr√©er l'√©quipe</h3>
                            <p>Ajoutez vos joueuses dans la section "√âquipe"</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>S√©lectionner la composition</h3>
                            <p>Choisissez vos 11 titulaires dans "Compo"</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>Lancer le match</h3>
                            <p>Utilisez l'interface "Match" pour suivre le jeu</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3>Partager en live</h3>
                            <p>G√©n√©rez un lien pour que d'autres suivent le match</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Confirmation Reset -->
    <div id="confirmResetModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeConfirmReset()">&times;</span>
            <h3>‚ö†Ô∏è Confirmation Reset</h3>
            <p>√ätes-vous s√ªr de vouloir effacer toutes les donn√©es ?</p>
            <p style="color: #e74c3c;">Cette action est irr√©versible !</p>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="confirmReset()">‚úÖ Oui, effacer tout</button>
                <button class="btn btn-secondary" onclick="closeConfirmReset()">‚ùå Annuler</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/storage.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Initialisation de la page d'accueil
        document.addEventListener('DOMContentLoaded', function() {
            loadMatchConfig();
            updateRecentStats();
            
            // Configuration de la date par d√©faut
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('matchDate').value = now.toISOString().slice(0, 16);
        });

        function startNewMatch() {
            if (confirm('Commencer un nouveau match ? (Les donn√©es actuelles seront perdues)')) {
                const config = getMatchConfig();
                setMatchConfig(config);
                
                // Cr√©er un nouveau match
                const matchData = {
                    id: Date.now().toString(),
                    config: config,
                    timestamp: new Date().toISOString(),
                    events: [],
                    score: { team: 0, opponent: 0 },
                    time: 0,
                    half: 1
                };
                
                saveData('currentMatch', matchData);
                showNotification('Nouveau match cr√©√© ! Allez dans "Match" pour commencer.');
                
                setTimeout(() => {
                    window.location.href = 'pages/match.html';
                }, 2000);
            }
        }

        function showConfirmReset() {
            document.getElementById('confirmResetModal').style.display = 'block';
        }

        function closeConfirmReset() {
            document.getElementById('confirmResetModal').style.display = 'none';
        }

        function confirmReset() {
            // Reset complet
            clearAllData();
            closeConfirmReset();
            showNotification('Toutes les donn√©es ont √©t√© effac√©es !');
            updateRecentStats();
        }

        function saveMatchConfig() {
            const config = getMatchConfig();
            setMatchConfig(config);
            showNotification('Configuration sauvegard√©e !');
        }

        function getMatchConfig() {
            return {
                teamName: document.getElementById('teamName').value.trim() || 'Mon √âquipe',
                opponentName: document.getElementById('opponentName').value.trim() || '√âquipe Adverse',
                venue: document.getElementById('venue').value.trim() || 'Stade Municipal',
                matchDate: document.getElementById('matchDate').value
            };
        }

        function loadMatchConfig() {
            const config = getMatchConfig();
            const saved = loadData('matchConfig');
            
            if (saved) {
                document.getElementById('teamName').value = saved.teamName || config.teamName;
                document.getElementById('opponentName').value = saved.opponentName || config.opponentName;
                document.getElementById('venue').value = saved.venue || config.venue;
                if (saved.matchDate) {
                    document.getElementById('matchDate').value = saved.matchDate;
                }
            }
        }

        function updateRecentStats() {
            const container = document.getElementById('recentStats');
            const players = loadData('players') || [];
            const currentMatch = loadData('currentMatch');
            
            if (players.length === 0 && !currentMatch) {
                container.innerHTML = '<p>Aucune donn√©e disponible. Commencez par cr√©er votre √©quipe !</p>';
                return;
            }
            
            let html = '';
            
            if (players.length > 0) {
                html += `<div class="stat-item">
                    <span class="stat-icon">üë•</span>
                    <span class="stat-text">${players.length} joueuses dans l'√©quipe</span>
                </div>`;
                
                const fieldPlayers = players.filter(p => p.status === 'field').length;
                if (fieldPlayers > 0) {
                    html += `<div class="stat-item">
                        <span class="stat-icon">üèüÔ∏è</span>
                        <span class="stat-text">${fieldPlayers} joueuses sur le terrain</span>
                    </div>`;
                }
            }
            
            if (currentMatch) {
                html += `<div class="stat-item">
                    <span class="stat-icon">‚öΩ</span>
                    <span class="stat-text">Match en cours: ${currentMatch.config?.teamName || 'Mon √âquipe'} vs ${currentMatch.config?.opponentName || '√âquipe Adverse'}</span>
                </div>`;
                
                html += `<div class="stat-item">
                    <span class="stat-icon">üïê</span>
                    <span class="stat-text">Score: ${currentMatch.score?.team || 0} - ${currentMatch.score?.opponent || 0}</span>
                </div>`;
            }
            
            container.innerHTML = html || '<p>Aucune donn√©e disponible.</p>';
        }

        function loadMatchFile() {
            document.getElementById('fileInput').click();
        }

        function downloadCurrentMatch() {
            const allData = {
                players: loadData('players') || [],
                currentMatch: loadData('currentMatch'),
                matchConfig: loadData('matchConfig'),
                timestamp: new Date().toISOString()
            };
            
            if (!allData.players.length && !allData.currentMatch) {
                showNotification('Aucune donn√©e √† sauvegarder !', 'error');
                return;
            }
            
            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `football_stats_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Donn√©es sauvegard√©es !');
        }

        // Gestion du chargement de fichier
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.players) {
                        saveData('players', data.players);
                    }
                    if (data.currentMatch) {
                        saveData('currentMatch', data.currentMatch);
                    }
                    if (data.matchConfig) {
                        saveData('matchConfig', data.matchConfig);
                        loadMatchConfig();
                    }
                    
                    updateRecentStats();
                    showNotification('Donn√©es charg√©es avec succ√®s !');
                } catch (error) {
                    showNotification('Erreur lors du chargement du fichier !', 'error');
                }
            };
            reader.readAsText(file);
        });
    </script>
</body>
</html>